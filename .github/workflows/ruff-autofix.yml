name: ruff_autofix
on:
  pull_request:

jobs:
  ruff_autofix:
    runs-on: ubuntu-latest

    # ❶ 기본 GITHUB_TOKEN에 push 권한 부여
    permissions:
      contents: write

    steps:
      # ❷ PR에서 실제 브랜치를 Checkout
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}

      - name: Run Ruff with autofix
        uses: chartboost/ruff-action@v1
        with:
          args: --fix .

      - name: Commit & push fixes
        uses: EndBug/add-and-commit@v9
        with:
          message: "chore: auto-fix imports via ruff [skip ci]"
          add: .
          # ❸ 푸시 대상 브랜치를 명시해야 detached HEAD 문제 해결
          branch: ${{ github.head_ref }}
          skip_dirty: true     # 변경 없으면 에러 대신 통과

          # 포크 PR·조직 레포라 기본 TOKEN이 막히면 ↓ 주석 해제
          # token: ${{ secrets.PAT_PUSH }}
