name: ruff_autofix
on:
  pull_request:

jobs:
  ruff_autofix:
    runs-on: ubuntu-latest

    permissions:
      contents: write          # âœ… PUSH ê¶Œí•œ

    steps:
      # 1) PR ë¸Œëœì¹˜ë¥¼ ê·¸ëŒ€ë¡œ ì²´í¬ì•„ì›ƒ
      - uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          persist-credentials: true   # PUSHí•  ë•Œ í•„ìš”

      # 2) Ruff ì‹¤í–‰
      - name: Run Ruff autofix
        uses: chartboost/ruff-action@v1
        with:
          args: --fix .

      # 3) ë³€ê²½ ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ + í‘¸ì‹œ
      - name: Commit & push fixes (manual)
        shell: bash
        run: |
          set -e
          echo "::group::Git status"
          git status --short
          echo "::endgroup::"

          # ë³€ê²½ëœ íŒŒì¼ ì—†ìœ¼ë©´ ë°”ë¡œ ì¢…ë£Œ
          if git diff --quiet && git diff --cached --quiet; then
            echo "ğŸ”¹ No changes to commit."
            exit 0
          fi

          echo "ğŸ”¸ Committing Ruff fixesâ€¦"
          git config user.name  "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "chore: auto-fix imports via ruff [skip ci]"

          echo "ğŸ”¸ Pushing to branch ${{ github.head_ref }} â€¦"
          git push origin HEAD:${{ github.head_ref }}

      # (ì˜µì…˜) PAT í•„ìš” ì‹œ token ì£¼ì…
      # ìœ„ checkout ìŠ¤í…ì— token: ${{ secrets.PAT_PUSH }} ì¶”ê°€
